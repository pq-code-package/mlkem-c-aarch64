# SPDX-License-Identifier: Apache-2.0

name: ci-ec2-any
on:
  workflow_dispatch:
    inputs:
      name:
        description: Alternative name of instance
        default: Graviton2
      ec2_instance_type:
        description: Type if EC2 instance to run on
        default: t4g.small
      ec2_ami_id:
        description: AMI ID
        default: ami-096ea6a12ea24a797
      cflags:
        description: Custom CFLAGS for compilation
        default:
      cross-prefix:
        description: Cross-compilation binary prefix, if any
        default: ' '
      always_terminate:
        description: Indicates if instance should always be terminated, even on failure
        default: 'true'
      functest:
        description: Whether to run functional tests
        default: 'true'
      lint:
        description: Whether to lint
        default: 'true'
      cbmc:
        description: Whether to run CBMC proofs
        default: 'false'
jobs:
  ci-ec2-any:
    name: Ad-hoc CI on $${{ github.event.inputs.ec2_instance_type }}
    uses: ./.github/workflows/ci_ec2_reusable.yml
    with:
      ec2_instance_type: ${{ github.event.inputs.ec2_instance_type }}
      ec2_ami_id: ${{ github.event.inputs.ec2_ami_id }}
      cflags: ${{ github.event.inputs.cflags }}
      crosss-prefix: ${{ github.event.inputs.cross-prefix }}
      functest: ${{ github.event.inputs.functest }}
      lint: ${{ github.event.inputs.lint }}
      cbmc: ${{ github.event.inputs.cbmc }}
      always_terminate: ${{ github.event.inputs.always_terminate }}
    secrets: inherit
