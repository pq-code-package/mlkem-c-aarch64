# SPDX-License-Identifier: Apache-2.0

name: bench-ec2-any
on:
  workflow_dispatch:
    inputs:
      name:
        description: Alternative name of instance
        default: Graviton2
      ec2_instance_type:
        description: Type if EC2 instance to benchmark on
        default: t4g.small
      ec2_ami_id:
        description: AMI ID
        default: ami-096ea6a12ea24a797
      cflags:
        description: Custom CFLAGS for compilation
        default:
      archflags:
        description: Custom ARCH flags for compilation
        default: -mcpu=cortex-a76 -march=armv8.2-a
      store_results:
        description: Indicates if results should be pushed to github pages
        type: boolean
        default: false
      always_terminate:
        description: Indicates if EC2 instance should always be terminated
        type: boolean
        default: true
      bench_extra_args:
        description: Additional command line to be appended to `tests bench` script
        default: ''
jobs:
  bench-ec2-any:
    name: Ad-hoc benchmark on $${{ inputs.ec2_instance_type }}
    uses: ./.github/workflows/bench_ec2_reusable.yml
    with:
      ec2_instance_type: ${{ inputs.ec2_instance_type }}
      ec2_ami_id: ${{ inputs.ec2_ami_id }}
      cflags: ${{ inputs.cflags }}
      archflags: ${{ inputs.archflags }}
      name: ${{ inputs.name }}
      store_results: ${{ inputs.store_results }}
      always_terminate: ${{ inputs.always_terminate }}
      bench_extra_args: ${{ inputs.bench_extra_args }}
    secrets: inherit
